<UserControl
  x:Class="DirN.Views.NodeCanvas"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
  xmlns:local="clr-namespace:DirN.Views"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:nd="clr-namespace:DirN.Utils.NgManager"
  xmlns:nodes="clr-namespace:DirN.Views.Node"
  xmlns:prism="http://prismlibrary.com/"
  xmlns:proxy="clr-namespace:DirN.Utils.BindingProxy"
  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
  xmlns:viewmodels="clr-namespace:DirN.ViewModels"
  d:DataContext="{d:DesignInstance Type=viewmodels:NodeCanvasViewModel}"
  d:DesignHeight="450"
  d:DesignWidth="800"
  prism:ViewModelLocator.AutoWireViewModel="True"
  Loaded="OnLoaded"
  mc:Ignorable="d">
  <UserControl.Resources>
    <proxy:BindingProxy x:Key="BindingProxy" Data="{Binding}" />
  </UserControl.Resources>
  <i:Interaction.Triggers>
    <i:EventTrigger EventName="MouseMove">
      <i:InvokeCommandAction Command="{Binding MouseMoveCommand}" PassEventArgsToCommand="True" />
    </i:EventTrigger>
    <i:EventTrigger EventName="MouseLeftButtonUp">
      <i:InvokeCommandAction Command="{Binding MouseLeftButtonUpCommand}" PassEventArgsToCommand="True" />
    </i:EventTrigger>
  </i:Interaction.Triggers>
  <Grid Background="Transparent">
    <Grid.ContextMenu>
      <ContextMenu DataContext="{StaticResource BindingProxy}" ItemsSource="{Binding Data.NodeGraphicsManager.CanvasContextMenu}">
        <ContextMenu.ItemContainerStyle>
          <Style TargetType="{x:Type MenuItem}">
            <Setter Property="Command" Value="{Binding Command}" />
            <Setter Property="CommandParameter" Value="{Binding CommandParameter}" />
            <Setter Property="AutomationProperties.Name" Value="A" />
          </Style>
        </ContextMenu.ItemContainerStyle>
        <ContextMenu.ItemTemplate>
          <HierarchicalDataTemplate DataType="{x:Type nd:MenuItemInfo}" ItemsSource="{Binding Items}">
            <TextBlock Text="{Binding Header}" />
          </HierarchicalDataTemplate>
        </ContextMenu.ItemTemplate>
      </ContextMenu>
    </Grid.ContextMenu>
    <Button
      HorizontalAlignment="Center"
      VerticalAlignment="Top"
      Command="{Binding TestCommand}"
      Content="Test" />
    <!--  Line Canvas  -->
    <ItemsControl ItemsSource="{Binding NodeGraphicsManager.BezierCurves}">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <Canvas />
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <Path Stroke="{Binding Brush}" StrokeThickness="{Binding Thickness}">
            <Path.Data>
              <PathGeometry>
                <PathFigure StartPoint="{Binding StartPoint}">
                  <BezierSegment
                    Point1="{Binding ControlPoint1}"
                    Point2="{Binding ControlPoint2}"
                    Point3="{Binding EndPoint}" />
                </PathFigure>
              </PathGeometry>
            </Path.Data>
          </Path>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>

    <!--  Node Canvas  -->
    <ItemsControl x:Name="NodeItems" ItemsSource="{Binding NodeGraphicsManager.Nodes}">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <Canvas />
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
      <ItemsControl.ItemContainerStyle>
        <Style TargetType="{x:Type ContentPresenter}">
          <Setter Property="Canvas.Left" Value="{Binding Position.X}" />
          <Setter Property="Canvas.Top" Value="{Binding Position.Y}" />
          <Setter Property="Panel.ZIndex" Value="{Binding ZIndex}" />
        </Style>
      </ItemsControl.ItemContainerStyle>
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <Thumb>
            <i:Interaction.Triggers>
              <i:EventTrigger EventName="DragDelta">
                <i:InvokeCommandAction Command="{Binding DragDeltaCommand}" PassEventArgsToCommand="True" />
              </i:EventTrigger>
              <i:EventTrigger EventName="DragStarted">
                <i:InvokeCommandAction Command="{Binding DragStartedCommand}" PassEventArgsToCommand="True" />
              </i:EventTrigger>
              <i:EventTrigger EventName="DragCompleted">
                <i:InvokeCommandAction Command="{Binding DragCompletedCommand}" PassEventArgsToCommand="True" />
              </i:EventTrigger>
            </i:Interaction.Triggers>
            <Thumb.Template>
              <ControlTemplate>
                <nodes:BaseNode DataContext="{Binding}" />
              </ControlTemplate>
            </Thumb.Template>
          </Thumb>
        </DataTemplate>
      </ItemsControl.ItemTemplate>

    </ItemsControl>

    <Canvas x:Name="DecorateCanvas" />
  </Grid>
</UserControl>
